<h2>ðŸš¨ Detected Anomalies</h2>

<div *ngIf="loading">Loadingâ€¦</div>
<div *ngIf="error" class="error">{{ error }}</div>

<table *ngIf="!loading">
  <thead>
    <tr>
      <th>#</th>
      <th>Customer</th>
      <th>Product</th>
      <th>Price</th>
      <th>Final Price</th>
      <th>Discount %</th>
      <th>Type</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let a of displayedAnomalies; let i = index; trackBy: trackById">
      <td>{{ currentPage * pageSize + i + 1 }}</td>
      <td>{{ a.customer_id }}</td>
      <td>{{ a.product_id }}</td>
      <td>{{ a.details.price }}</td>
      <td>{{ a.details.final_price }}</td>
      <td>{{ a.details.discount_pct }}</td>
      <td>{{ a.anomaly_type }}</td>
    </tr>
  </tbody>
</table>

<!-- Pagination -->
<div class="pagination">
  <button (click)="prevPage()" [disabled]="currentPage === 0">Prev</button>

  <button
    *ngFor="let p of pages"
    (click)="setPage(p)"
    [class.active]="p === currentPage">
    {{ p + 1 }}
  </button>

  <button
    (click)="nextPage()"
    [disabled]="currentPage === totalPages - 1">
    Next
  </button>
</div>


<!-- CHARTS -->
<div *ngIf="!loading && anomalies.length > 0" class="charts">
  <div class="chart-wrapper">
    <h3>Anomalies by Type</h3>
    <canvas #typeChart></canvas>
  </div>

  <div class="chart-wrapper">
    <h3>Discount Severity</h3>
    <canvas #discountChart></canvas>
  </div>
</div>

<div *ngIf="!loading && anomalies.length === 0">
  No anomalies detected.
</div>
